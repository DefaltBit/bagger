##MACROS
#macro (details)
	<div id="taskDetails">
    	<h2>Details</h2>
    	<dl>
    		<dt>Task Id:</dt>
    		<dd>${taskInstanceBean.id}</dd>
    		<dt>Name:</dt>
    		<dd>${taskInstanceBean.taskBean.name}</dd>
    		<dt>Workflow:</dt>
    		<dd><a href="${contextPath}/processinstance/${taskInstanceBean.processInstanceBean.id}.html">
			            ${taskInstanceBean.processInstanceBean.processDefinitionBean.name}
                        (${taskInstanceBean.processInstanceBean.id}) </a>                        
            </dd>
            <dt>Task owner:</dt>
            <dd>
                    #if ($taskInstanceBean.userBean) $taskInstanceBean.userBean.name #else UNASSIGNED #end
            </dd>
            <dt>Groups:</dt>
            <dd>
                    #foreach($groupBean in $taskInstanceBean.groupBeanList) $groupBean.name | #end
            </dd>
            <dt>Status:</dt>
            <dd>
                    #if ( $taskInstanceBean.ended ) Completed #else Incomplete #end
            </dd>
            <dt>Date Task Created:</dt>
            <dd>          
                    ${date.format('yyyy-MM-dd hh:mm', $taskInstanceBean.createDate)}
            </dd>
            #if ( $task.ended )
            	<dt>Date Ended:</dt>
            	<dd>
                    ${date.format('yyyy-MM-dd hh:mm', $taskInstanceBean.endDate)}
                </dd>
            #end
        </dl>
    </div>	
#end

<div id="taskinstance">    
     #if ($formViewName)
	    <div id="updateTask">
	    	<h2>Update task</h2>
		    #if ($instructionViewName)
		    	<div id="instructions">
    				<h3>Instructions</h3>
    				#include("${instructionViewName}.vm")
    			</div>
    		#end    		
	    	#if ($errorList.size() > 0)
	    		<div id="errors">
	    			<h3>Errors</h3>	    			
				    <ul>
					    #foreach($error in $errorList)
					    	<li>$error</li>
					    #end
				    </ul>
				</div>
	    	#end
			<form method="post" action="${requestURI}" enctype="multipart/form-data">
				<input type="hidden" name="method" value="put"/>
				<fieldset>
					<legend>Variables</legend>				
					#parse( "${formViewName}.vm" )
				</fieldset>
				<fieldset>
				    <legend>Select a transition</legend>
	    			<select id="transition" name="transition">	
	    				#foreach($transitionBean in $taskInstanceBean.taskBean.leavingTransitionBeanList)	
	    					<option value="$transitionBean.id" #if($transitionBean.id=="continue") selected #end>
	    					    $transitionBean.name
	    					</option>
	    				#end
	    				<option value="null">leave task as incomplete</option>    				
	    			</select>							
	    			<input class="button" type="submit" value="submit"/>
				</fieldset>
			</form>
			#details()
		</div>
    #else
		<div id="taskDetails">
			#details()
	    </div>
	#end

    #if ($permissions.canUpdateTaskInstanceUser() && $taskInstanceBean.canUpdateUserBean())
	<div id="reassignTask">
	    <h2>Reassign Task</h2>
	    <form method="post" action="${requestURI}">
	    	<input type="hidden" name="method" value="put" />
            <label for="taskReassingee">User</label>
		    <select id="taskReassignee" name="user">
		    	#if (${taskInstanceBean.canUnassignUserBean()})
    				<option value="null">none</option>
    			#end
    			#foreach($userBean in $userBeanList)
    				<option value="$userBean.id">$userBean.name</option>					
    			#end				
    		</select>
    		<input class="button" type="submit" value="submit"/>
    	</form>
	</div>
    #end

    <div id="comments">
	    <h2>Comments</h2>
		#list_comments($taskInstanceBean.processInstanceBean.commentBeanList)
    	#if ($permissions.canAddComment())
	    	<div id="addComment">
	    	    <h3>Add Comment</h3>
				<form method="post" action="${contextPath}/processinstance/${taskInstanceBean.processInstanceBean.id}/comment.html">
			        <input type="hidden" name="referer" value="/taskinstance/${taskInstanceBean.id}.html#comments" />
					<textarea name="message" cols="50" rows="15"></textarea>				
			        <input class="button" type="submit" value="create"/>
				</form>						
	    	</div>
        #end
    </div> 
</div>