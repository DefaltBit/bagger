<h2>Process instance</h2>

<p>Id: ${processInstanceBean.id}</p>
#set ($code = "processdefinitions.${processInstanceBean.processDefinitionBean.id}")
<p>Process definition: #springMessage($code)</p>
#set($packageName = "none")
#set($packageName = $processInstanceBean.packageName)
<p>Package name: $packageName</p>
<p>Suspended: $processInstanceBean.suspended</p>
#if ($permissionsHelper.canSuspendProcessInstance())
    <form method="post" action="${requestURI}?method=put">    		
	#if ($processInstanceBean.suspended)
		<input type="hidden" name="suspended" value="false" />
		<input type="submit" value="resume" />
	#else
		<input type="hidden" name="suspended" value="true" />
		<input type="submit" value="suspend" />
	#end
	</form>
#end
<h3>Variables</h3>
<ul>
	#foreach($key in $processInstanceBean.variableMap.keySet())
		#set($value = $processInstanceBean.variableMap.get($key))
		<li>
			##At least for now, until allow update of strings
			#if ($permissionsHelper.canUpdateVariables() && $value.class.simpleName == "String")
			    <form method="post" action="${requestURI}?method=put">    		
					$key = <input type="text" name="variable.${key}" value="$value" />
					<input type="submit" value="update" />
				</form>
			#else
				$key = $value			
			#end
		</li>
	#end	
</ul>	
<h3>Comments</h3>
	#foreach($commentBean in $processInstanceBean.commentBeanList)
		<p>$commentBean.message<br/>
		-- $commentBean.actorId ($commentBean.date)</p>
	#end
    #if ($permissionsHelper.canAddComment())
	<div id="addComment">
	    <h4>Add Comment</h4>
			<form method="post" action="${contextPath}/processinstance/${processInstanceBean.id}/comment.html">
				<textarea name="message"></textarea>				
				<input type="submit" value="create"/>
			</form>						
	</div>
    #end
	
<h3>Tokens</h3>
	#foreach($tokenBean in $processInstanceBean.tokenBeanList)
		<h4>Token</h4>
		<p>Id: $tokenBean.id</p>
		#if ($tokenBean.movable && $permissionsHelper.canMoveToken())
			<form method="post" action="${contextPath}/token/${tokenBean.id}.html?method=put">
				<input type="hidden" name="referer" value="/processinstance/${processInstanceBean.id}.html" />		    	
			    <select name="node">
	    			#foreach($nodeBean in $nodeBeanList)
	    				<option value="$nodeBean.name" #if ($tokenBean.nodeBean.name == $nodeBean.name) selected #end>$nodeBean.name</option>					
	    			#end				
	    		</select>				
				<input type="submit" value="move"/>
			</form>
		#else
			<p>Node: $tokenBean.nodeBean.name</p>			
		#end		
		<p>Ended: $tokenBean.ended</p>
		#if ($tokenBean.child)
			<p>Parent: $tokenBean.parentTokenBean.id</p>
		#end
		<h5>Log entries</h5>
			<ol>
				#foreach($entry in $tokenBean.logEntryList)
					<li>$entry</li>
				#end				
			</ol>
		<h5>Task instances</h5>
		#foreach($taskInstanceBean in $tokenBean.taskInstanceBeanList)
			<h6><a href="${contextPath}/taskinstance/${taskInstanceBean.id}.html">Task instance</a></h6>
			<p>Id: $taskInstanceBean.id</p>
			<p>Task:  $taskInstanceBean.taskBean.name</p>
			<p>User:  #if ($taskInstanceBean.userBean) $taskInstanceBean.userBean.id #else UNASSIGNED #end</p>
			#if ($permissionsHelper.canUpdateTaskInstanceUser())
			
			    <form method="post" action="${contextPath}/taskinstance/${taskInstanceBean.id}.html?method=put">
					<input type="hidden" name="referer" value="/processinstance/${processInstanceBean.id}.html" />		    	
				    <select name="user">
		    			<option value="null">none</option>
		    			#foreach($userBean in $userBeanList)
		    				<option value="$userBean.id" #if ($taskInstanceBean.userBean.id == $userBean.id) selected #end>$userBean.id</option>					
		    			#end				
		    		</select>
		    		<input type="submit" value="reassign"/>
		    	</form>
			#end						
			<p>Groups:  #foreach($groupBean in $taskInstanceBean.groupBeanList) $groupBean.id #end</p>
			<p>Status:  #if ( $taskInstanceBean.ended ) Completed #else Incomplete #end</p>
			<p>Create date:  $taskInstanceBean.createDate</p>
            #if ( $taskInstanceBean.ended )
	            <p>Completion date: $taskInstanceBean.endDate</p>
            #end						
		#end
	#end