<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:p="http://www.springframework.org/schema/p" 
    xmlns:context="http://www.springframework.org/schema/context"
    xsi:schemaLocation="
        http://www.springframework.org/schema/beans 
        http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
        http://www.springframework.org/schema/context 
        http://www.springframework.org/schema/context/spring-context-2.5.xsd">

    <context:component-scan base-package="gov.loc.repository.transfer.ui.controllers" />

    <bean id="messageSource" class="org.springframework.context.support.ResourceBundleMessageSource">
    	<property name="basenames">
    		<list>
    			<value>messages</value>
    			<value>application</value>
    		</list>
    	</property>
    </bean>
    
    <!--bean id="tilesConfigurer" class="gov.loc.repository.transfer.ui.springframework.TilesConfigurer">
    	<property name="definitionPattern"  value="page-views*.xml" />
    	<property name="definitionPath"     value="/WEB-INF/views" />
    </bean-->
    
    <bean id="tilesConfigurer" class="gov.loc.repository.transfer.ui.springframework.TilesConfigurer">
	    <property name="factoryClass" value="org.apache.struts.tiles.xmlDefinition.I18nFactorySet"/>
		<property name="definitionPath" value="/WEB-INF/views/" />
		<property name="definitionPattern" value="pages-*.xml" />
    </bean>

	<bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
		<property name="maxUploadSize" value="1000000"/>
	</bean>
	
	<bean id="velocityConfig" 
    class="org.springframework.web.servlet.view.velocity.VelocityConfigurer">
		<property name="resourceLoaderPath" value="/WEB-INF/views/templates"/>
		<property name="velocityProperties"> <props>
				<prop key="input.encoding"                      >UTF-8</prop>
				<prop key="output.encoding"                     >UTF-8</prop>
				<prop key="runtime.log.logsystem.class"         >org.apache.velocity.runtime.log.SimpleLog4JLogSystem</prop>
				<prop key="runtime.log.logsystem.log4j.category">org.apache.velocity.runtime.log.SimpleLog4JLogSystem</prop>
				<prop key="runtime.log.error.stacktrace"        >false</prop>
				<prop key="runtime.log.warn.stacktrace"         >false</prop>
				<prop key="runtime.log.info.stacktrace"         >false</prop>
				<prop key="runtime.log.invalid.reference"       >true</prop>
		        <prop key="velocimacro.library"                 >macros-functions.vm</prop>
				<prop key="velocimacro.permissions.allow.inline">true</prop>
				<prop key="velocimacro.permissions.allow.inline.to.replace.global">false</prop>
				<prop key="velocimacro.permissions.allow.inline.local.scope">false</prop>
				<prop key="velocimacro.context.localscope"      >false</prop>
				<prop key="velocimacro.library.autoreload"      >true</prop>
				<prop key="file.resource.loader.cache"          >false</prop>
				<prop key="directive.foreach.counter.name"      >velocityCount</prop>
				<prop key="directive.foreach.counter.initial.value">1</prop>
		</props> </property>
	</bean>	

  <bean id="viewResolver" class="org.springframework.web.servlet.view.velocity.VelocityViewResolver">
  	<property name="cache"                    value="true" />
  	<property name="prefix"                   value="" />
  	<property name="exposeSpringMacroHelpers" value="true" />
  	<property name="order"                    value="1"/>
  	<property name="contentType"              value="text/html; charset=utf-8"/>
  	<property name="toolboxConfigLocation"    value="WEB-INF/velocity-toolbox.xml"/>
    <property name="suffix"                   value="" />
    <property name="viewClass"                value="gov.loc.repository.transfer.ui.springframework.VelocityTilesView" />
  </bean>
</beans>
