<?xml version="1.0" encoding="UTF-8"?>

<process-definition
  xmlns=""  name="prototype1">
   <start-state name="zip detected">
      <transition name="continue" to="unzip"></transition>
   </start-state>   
   <node name="unzip" async="true">
      <action class="gov.loc.repository.workflow.actionhandlers.UnzipActionHandler" name="unzip">
         <baseDestinationDirectory>c:/temp</baseDestinationDirectory>
      </action>
      <transition name="troubleshoot" to="troubleshoot unzip"></transition>
      <transition name="continue" to="validate">
         <action name="adapt variable" class="gov.loc.repository.workflow.actionhandlers.VariableAdapterActionHandler">
            <fromVariableName>destinationDirectory</fromVariableName>
            <toVariableName>packageDirectory</toVariableName>
         </action>
      </transition>
   </node>
   <end-state name="end1"></end-state>
   <task-node name="troubleshoot unzip"></task-node>
   <node name="validate">
      <action name="httpsync" class="gov.loc.repository.workflow.actionhandlers.SimpleHttpSyncActionHandler">
         <baseUrl>http://foo.com/bar.html</baseUrl>
         <variableList>packageDirectory</variableList>
      </action>
      <transition name="troubleshoot" to="troubleshoot validate"></transition>
      <transition name="continue" to="verify"></transition>
   </node>
   <task-node name="troubleshoot validate"></task-node>
   <state name="verify">
      <event type="node-enter">
         <action name="httpasync" class="gov.loc.repository.workflow.actionhandlers.SimpleHttpAsyncActionHandler">
            <baseUrl>http://localhost/request.html</baseUrl>
            <callbackBaseUrl>http://localhost/response.html</callbackBaseUrl>
         </action>
      </event>
      <transition name="troubleshoot" to="troubleshoot verify"></transition>
      <transition name="continue" to="quality review"></transition>
   </state>
   <task-node name="troubleshoot verify"></task-node>
   <fork name="fork1">
      <transition name="continue2" to="ingest"></transition>
      <transition name="continue1" to="backup"></transition>
   </fork>
   <node name="ingest">
      <action class="gov.loc.repository.workflow.actionhandlers.LoggingActionHandler">
         <message>Performing ingest</message>
         <wait>true</wait>
      </action>
      <transition name="continue" to="join1"></transition>      
   </node>
   <join name="join1">
      <transition name="continue" to="end1"></transition>
   </join>
   <task-node name="quality review">
      <task name="quality review task">
         <assignment expression="group(qr)"></assignment>
      </task>
      <transition name="continue" to="fork1"></transition>
      <transition name="troubleshoot" to="troubeshoot quality"></transition>
   </task-node>
   <task-node name="troubeshoot quality"></task-node>
   <process-state name="backup">
   	  <sub-process name="prototype1b" />
      <transition name="continue" to="join1"></transition>
   </process-state>
</process-definition>